# Knowledge Base (DocPack v1)

Цель: иметь локальные доки и best practices по нескольким языкам в **унифицированном** формате, чтобы RAG-слой мог одинаково индексировать и цитировать источники.

## Единый интерфейс для всех языков

Каждый язык = модуль (папка) с одинаковой структурой:

```
rag-ml/kb/
  manifest.json
  languages/
    python/
      manifest.json
      docs/
        00-readme.md
        01-*.md
        02-*.md
    javascript/
      manifest.json
      docs/...
    ...
```

RAG-индексатор (какой бы он ни был: Python/TS) может работать так:
1. Прочитать `rag-ml/kb/manifest.json` → список языков.
2. Для каждого языка прочитать `languages/<slug>/manifest.json`.
3. Взять все файлы из `docRoots[]` (или по умолчанию `docs/`) как документы.
4. Поддерживаемые форматы для MVP: `.md`, `.txt`, `.html`.
4. Разбить на чанки (по заголовкам/размеру) и проиндексировать.

Никаких языковых “костылей” для **хранения доков** не нужно: всё одинаково. Языковые особенности появляются только на уровне анализа кода (AST, правила агента), но не на уровне KB.

## Как хранить большие доки

Да, можно “засунуть в README”, но для практики лучше:
- не держать один гигантский файл;
- разбить на главы: `01-intro.md`, `02-syntax.md`, `03-stdlib.md`, ...
- держать **размер файла разумным** (ориентир: до 1–2MB), чтобы индексатору было проще.

## Что коммитим в Git, а что нет

Рекомендация для MVP:
- Коммитим: `docs/*.md|*.txt` (лучше курированные/извлеченные тексты), `manifest.json`.
- Не коммитим: сырые архивы/пдф/скачанные дампы. Для этого есть папки `raw/`, `downloads/`, `build/` (они в `.gitignore`).

Причины: размер репы, лицензии, лимиты GitHub.

## Минимальный `manifest.json` языка

Держим метаданные рядом с доками:
- `language` и `displayName`
- `defaultVersion` (какую версию доков мы считаем актуальной)
- `sources[]` (откуда взяли текст; для цитат и атрибуции)
- `docRoots[]` (опционально): какие папки индексировать (например `["docs","raw/python-docs-text"]`)

При желании можно расширять (license, updatedAt, notes).

## Как привязать главы к источникам (важно для цитат)

Если в `sources[]` больше одного источника, RAG-слою нужно понимать, откуда конкретная глава.

Два простых подхода (выбери один и держись его везде):

1) Подпапки по `sourceId` (рекомендовано)

```
languages/python/docs/python-docs-text/01-language-reference.md
languages/python/docs/owasp-cheatsheets/01-injection.md
```

Индексатор читает относительный путь и сохраняет `sourceId` как метадату чанка.

2) YAML front matter в каждом файле (если не хочешь подпапки)

```md
---
sourceId: python-docs-text
sourceUrl: https://docs.python.org/3/download.html
---
# Заголовок
Текст...
```

В MVP можно начать с подхода (1), потому что он проще и не требует парсинга front matter.

## Быстрый старт (получить тексты под коммит)

1) Скачать сырьё (zip/pdf/html) в gitignored папки:

```bash
./rag-ml/kb/pull-docs.sh
```

2) Собрать “commit-ready” тексты в `docs/<sourceId>/...`:

```bash
python3 -m pip install -r rag-ml/requirements.txt
./rag-ml/kb/build-docs.py
```

После этого можно коммитить `rag-ml/kb/languages/*/docs/**` (а `raw/` и `downloads/` останутся локально и не попадут в git).
