# AI Code Review Plugin (GitHub/GitLab)

## Концепция

Разработать плагин для GitHub/GitLab, который автоматически проводит code review для pull request'ов.

В основе системы лежат специализированные AI-агенты (для безопасности, производительности, стиля), которые используют RAG для доступа к best practices.

Ключевая особенность — система обучается и адаптируется к стилю и требованиям конкретной команды разработки, используя механизм обратной связи (RLHF/GRPO), где разработчики оценивают полезность предложенных рекомендаций.

## Основной функционал (базовые требования)

1. Интеграция с Git
   - Реализовать интеграцию с GitHub/GitLab API для получения изменений кода из pull request'ов и отправки комментариев.

2. Базовый анализ (RAG)
   - Создать RAG-систему, где базой знаний выступает официальная документация языка программирования и общепринятые best practices.
   - Система должна анализировать код и оставлять базовые комментарии, ссылаясь на источники.

3. Интерфейс для обратной связи
   - В веб-интерфейсе реализовать простую систему, где разработчик может отметить комментарии AI как "полезные" или "неполезные".

4. Обработка сложных данных
   - Система должна корректно анализировать большие pull request'ы с изменениями в нескольких файлах.

## Пути развития и усложнения проекта (для максимальных баллов)

### Мульти-агентная система (LangChain)

Необходимо реализовать систему из нескольких специализированных агентов:

- Агент по безопасности: ищет потенциальные уязвимости (SQL-инъекции, XSS и т.д.).
- Агент по производительности: ищет неоптимальный код, "бутылочные горлышки".
- Агент по стилю и читаемости: проверяет соответствие кода стайлгайду команды.

### Обучение на основе предпочтений (RLHF/GRPO)

Ключевая исследовательская задача — реализовать полный цикл обучения:

- система собирает оценки ("полезно"/"неполезно") от разработчиков;
- система использует их для дообучения модели (например, через Direct Preference Optimization);
- цель: со временем система перестаёт давать нерелевантные советы и подстраивается под уникальные стандарты команды.

### Квантование и оптимизация

Оптимизировать модель для быстрого инференса (например, через квантование до INT8), чтобы review проходило быстро и не задерживало процесс разработки.

Это критично для low-compute инференса и позволяет разворачивать систему локально (on-premise).

### Анализ аналогов и ЦА

Провести глубокий анализ существующих AI-инструментов для code review (GitHub Copilot, CodeRabbit, Snyk), определить их слабые места и обосновать, почему подход с RLHF и мульти-агентностью более гибкий и мощный.

## Для исследовательского трека

### Передовые RAG-методы

Реализовать RAG, который использует в качестве контекста не просто документацию, а AST или графы зависимостей кода.

Это позволит агентам проводить более глубокий и контекстно-зависимый анализ, а не только поиск паттернов по тексту.

### Новизна архитектуры

Исследовать и доказать на практике, что RLHF/GRPO-подход для адаптации code review ассистента даёт лучшие результаты (более высокая релевантность советов), чем классический fine-tuning на существующей кодовой базе.

### Другие новшества

Внедрить агента-архитектора, который анализирует не только отдельный pull request, но и его влияние на кодовую базу в целом.

Агент может выявлять нарушение архитектурных принципов (например, SOLID) и появление циклических зависимостей.

## Ожидаемый результат

Рабочий плагин для GitHub или GitLab, который автоматически комментирует pull request'ы.

Должен быть предоставлен веб-интерфейс, где команда может:

- просматривать аналитику;
- оценивать предложенные исправления;
- тем самым обучать и адаптировать модель.

## План на 2–3 недели

### Неделя 1 (Backend Lead)

- GitHub App / OAuth (предпочтительно GitHub App)
- Подключение репозитория
- Pull PR diff + metadata
- Хранение: PR, файлы, чанки, комментарии, голоса

### Неделя 2

- API для analysis job: создать/запустить/получить статус
- Простейший RAG (docs + best practices) + генерация комментариев
- Отправка комментариев в PR

### Неделя 3

- UI фидбека (полезно/неполезно)
- Простая адаптация: rerank/фильтрация по голосам (даже без RLHF)
- Поддержка больших PR: лимиты, инкрементальность (хотя бы по файлам)

## Минимальная архитектура

### Backend

- Интеграция с GitHub API
- Нормализация diff -> PR snapshot
- Очередь job'ов (минимум: in-memory/DB + worker)
- Хранилище comments + feedback

### RAG/ML

- Индексация knowledge base (docs, best practices)
- Retrieval + prompt + генерация suggestions
- Scoring/ранжирование + dedupe

### Frontend

- Страница PR / список комментариев
- Кнопки полезно/неполезно
- Отображение ссылок-источников

## API endpoints (первый набор)

### A) Интеграция и репозитории

- `POST /integrations/github/install`
  - принимает `installation_id` (или берётся через flow)
- `GET /repos`
  - список доступных репозиториев

### B) PR ingestion

- `POST /repos/{repoId}/prs/{prNumber}/sync`
  - тянет PR metadata + files + diff, сохраняет snapshot
  - возвращает: `prId`, `snapshotId`, `counts` (`files`, `additions`, `deletions`)

- `GET /prs/{prId}`
  - мета PR + состояние последнего snapshot

- `GET /prs/{prId}/files`
  - список файлов: `path`, `status`, `additions/deletions`, `language`

- `GET /prs/{prId}/diff?file=...`
  - нормализованный diff для одного файла (или батч)

### C) Анализ как job

- `POST /prs/{prId}/analysis-jobs`
  - body:
    - `snapshotId`
    - `scope`: `["security", "style", "bugs"]`
    - `files`: optional list
    - `maxComments`: число
  - returns: `jobId`

- `GET /analysis-jobs/{jobId}`
  - `status`: `queued|running|done|failed`
  - `progress`: `filesDone/total`
  - `summary`

- `GET /analysis-jobs/{jobId}/results`
  - список suggestions:
    - `{filePath, lineStart, lineEnd, severity, title, body, citations[]}`
  - где `citations[]` = `{sourceId, title, url, snippet}`

### D) Публикация комментариев в PR

- `POST /prs/{prId}/publish`
  - body:
    - `jobId`
    - `mode`: `review_comments | issue_comments`
    - `dryRun`: `true/false`
  - returns: сколько отправлено, ошибки

- `GET /prs/{prId}/comments`
  - комментарии, созданные/отправленные системой (с mapping на GitHub comment id)

### E) Фидбек (UI и адаптация)

- `POST /comments/{commentId}/feedback`
  - body: `{vote: "up"|"down", reason?: string}`

- `GET /prs/{prId}/feedback-summary`
  - агрегаты по файлам/типам/серьёзности

## Формат данных для RAG-команды

Нормализованный объект `PRSnapshot`:

- `snapshotId`, `commitSha`, `baseSha`, `headSha`
- `files[]`:
  - `path`, `status`, `language`
  - `patch` (unified diff)
  - `hunks[]` (опционально)
  - `lineMap` (опционально: сопоставление diff -> new file line)

Минимум для старта: `patch + path + language`.
